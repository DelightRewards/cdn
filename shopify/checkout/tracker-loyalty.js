const targetScript=document.querySelector("#delight-tracker-loyalty"),storeKey=targetScript.getAttribute("data-store"),sendPayloadToBackend=async e=>{await fetch("https://us-central1-spherical-gate-286620.cloudfunctions.net/loyalty",{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({store:storeKey,data:e})});const t=(new Date).toISOString();localStorage.setItem("delight-post",t)};window.addEventListener("load",async()=>{const e=localStorage.getItem("delight-post");if(e){const t=new Date(e),o=new Date;t.toISOString().slice(11,16).replace(/-/g,"")!==o.toISOString().slice(11,16).replace(/-/g,"")&&Shopify.checkout&&sendPayloadToBackend({orderId:Shopify.checkout.order_id,email:Shopify.checkout.email,name:Shopify.checkout.billing_address.first_name,items:Shopify.checkout.line_items,user:ShopifyAnalytics.lib.user().traits().uniqToken,loyalty:!0})}else Shopify.checkout&&sendPayloadToBackend({orderId:Shopify.checkout.order_id,email:Shopify.checkout.email,name:Shopify.checkout.billing_address.first_name,items:Shopify.checkout.line_items,user:ShopifyAnalytics.lib.user().traits().uniqToken,loyalty:!0})});